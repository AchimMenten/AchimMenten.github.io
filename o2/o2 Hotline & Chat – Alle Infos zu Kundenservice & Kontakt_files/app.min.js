var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.AdServerConnector=function(e){var t=o2.chat.Q.defer(),o=e.defaultText,n=function(){return Math.floor(1e6*Math.random())};e.queryAdServer?$.ajax({url:"/are-wp/"+n()+"/",timeout:e.adServerTimeoutInMs,dataType:"html",data:{sid:e.adSpaceId,ac:1,wi:n(),"prf[pr]":0,"prf[sy]":"www"},success:function(n){n&&(n.match(/<\/?[^>]+>/gi)||n.match(/[\x00-\x09\x0E-\x1F]/gi)||(n=n.trim(),n.length>0&&n.length<=e.maxTextLength&&(o=n))),t.resolve()},error:function(e,o,n){t.resolve()}}):t.resolve();var r=function(){throw"Unsupported operation"};Object.defineProperties(this,{value:{get:function(){return o},set:r,enumerable:!0},promise:{get:function(){return t.promise},set:r,enumerable:!0}})};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.BoConfiguration=function(e){"use strict";var t=o2.chat.Q.defer(),o=o2.chat.Q.defer(),n=o2.chat.Q.allSettled([t.promise,o.promise]),r=o2.chat.Q.defer(),a=!1,i=this,c={customerGroups:[{label:"Neuvertrag & Bestellung",topicKey:"Interessent",preselectionKey:"nk",serviceName:"TS_C_SONSTIGE2",showPersonalData:{name:!0,phone:!0,topic:!0,question:!0}},{label:"Kundenservice & VertragsverlÃ¤ngerung",topicKey:"Kundenbetreuung",preselectionKey:"bk",serviceName:"TS_C_DSL_INTERESSENTEN",showPersonalData:{name:!1,phone:!1,topic:!0,question:!0}}]},s={},l={};e.connector.getConfig(function(e){var o={};$.extend(!0,o,c,e.config),s={departments:o.departments.department,customerGroups:o.customerGroups,content:o.content},$.extend(!0,s,o.chat_global,o.chat),t.resolve()}),e.connector.getOpenDepartments(function(e){l=e,o.resolve()}),this.refreshOpenDepartments=function(){var t=o2.chat.Q.defer();return e.connector.getOpenDepartments(function(e){l=e,t.resolve()}),t};var u=function(){throw"Unsupported operation"};n.then(function(){var e={};e.promise={enumerable:!0,configurable:!0,value:r.promise,writable:!1};for(var t in s)if(s.hasOwnProperty(t)){var o=s[t];e[t]={enumerable:!0,configurable:!0,value:o,writable:!1}}e.openDepartments={enumerable:!0,configurable:!0,get:function(){return l},set:u},e.initialized={enumerable:!0,configurable:!0,get:function(){return a},set:u},Object.defineProperties(i,e),a=!0,r.resolve()}),Object.defineProperties(this,{promise:{enumerable:!0,configurable:!0,value:r.promise,writable:!1},initialized:{enumerable:!0,configurable:!0,get:function(){return a},set:u}})};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.BoServiceConnector=function(e,t,o){"use strict";var n=t.baseUrl,r=t.cfgPath;r||(r="/");var a="JSON",i=5e3;this.getConfigSummary=function(t){var o={brandId:e,path:r};c("getConfigSummary.json",o,t)},this.getConfig=function(t){var o={brandId:e,path:r};c("getConfig.json",o,t)},this.getOpenDepartments=function(t){var o={brandId:e};c("openDepartments.json",o,t)};var c=function(e,t,r){var c=n+e;$.ajax(c,{dataType:a,timeout:i,success:function(e){e&&e.config&&e.config.chat_global&&$.isNumeric(e.config.chat_global.serviceTimeout)&&(i=e.config.chat_global.serviceTimeout),r(e)},data:t,error:function(e){o(c,"GET",a,t,e.status,e.statusText,!0)}})}};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.dataPropertyName="o2.chat.Chat",o2.chat.Chat=function(e,t){"use strict";var o,n=this,r=e,a=o2.chat.Q.defer();this.initializationPromise=a.promise,"chat"===o2.chat.Util.getUrlParameter("debug")&&o2.chat.DebugConsole&&(o=new o2.chat.DebugConsole);var i,c={personalData:{name:{regexp:/^.{4,}$/,errmsg:"personalData.name.errmsg"},phone:{regexp:/^$|\+?\d{5,}$/,errmsg:"personalData.phone.errmsg"},topic:{regexp:/^[^_]+$/,errmsg:"personalData.topic.errmsg"},question:{regexp:/.+/,errmsg:"personalData.question.errmsg"}}},s={layout:null,content:null,initialized:null,storage:null,storageLoaded:!1},l=null,u=null,h=null,p=!1,d=null,f=null,g=new o2.chat.CustomerData,m=null,v=-1,y=0,w=0,C=3,E=1e3,b=0,T=2,k=[],S=null,D={currentDelay:0,counter:0,showTimeoutId:0,closeTimeoutId:0,triggered:!1,closedPermanently:!1},I={},P=new o2.chat.Options(t),O={};P.bo.baseUrl.indexOf("/",P.bo.baseUrl.length-1)<0&&(P.bo.baseUrl=P.bo.baseUrl+"/");var U=new o2.chat.BoServiceConnector(P.brandId,P.bo,function(e,t,o,n,a,i,c){e.indexOf("getConfig.json")>=0&&(r.popover({content:P.bo.errorMessage,html:!0,placement:"bottom",trigger:"manual",animation:!1}),r.popover("show")),te({request:{url:e,method:t,responseEncoding:o,data:n,status:a,statusText:i,httpError:c}})}),A=null,x=null,N=null,L=new o2.chat.CommandHandlers(this);window.addEventListener("message",function(e){try{var t={};try{t=JSON.parse(e.data)}catch(o){return}t.callback&&I.hasOwnProperty(t.callback)&&I[t.callback](t)}catch(o){te(o)}}),$(window).bind("mousemove scroll",function(){0!==D.showTimeoutId&&(window.clearTimeout(D.showTimeoutId),0!==D.currentDelay&&(D.showTimeoutId=window.setTimeout(Oe,D.currentDelay)))});var _=function(){U.getConfigSummary(function(e){if(e.showPopup&&void 0!==e.invitationPopupDelay&&P.embedded&&(D.currentDelay=e.invitationPopupDelay,D.showTimeoutId=window.setTimeout(Oe,e.invitationPopupDelay)),oe(e.showChat),e.showChat){Ce("connection","connection"),A=new o2.chat.ChatServiceConnector({brandId:P.brandId,serviceHost:e.serviceBackend,useSSL:e.useSSL,timeout:e.serviceTimeout},function(e,t,o,n,r,a,i,c){te({request:{url:e,method:t,responseEncoding:o,data:n,status:r,statusText:a,httpError:i,errorType:c}})});var t=o2.chat.Q.defer(),o=[t.promise],n=o2.chat.Util.getUrlParameter("chat-devicetype");if(n)l=n,t.resolve();else{var r=new o2.chat.DeviceTypeServiceConnector({endpoint:e.deviceTypeServiceEndpoint,timeout:e.serviceTimeout,defaultDeviceType:e.defaultDeviceType});r.promise.then(function(){l=r.deviceType,t.resolve()})}u=new o2.chat.CustomerServiceConnector({endpoint:e.customerServiceEndpoint,timeout:e.serviceTimeout,chatServiceConnector:A}),o2.chat.Q.allSettled(o).then(function(){a.resolve()})}})};if(null!==P.templates.storage){var R=$($.parseHTML('<iframe src="'+P.bo.baseUrl+'storage.html"></iframe>')[0]);R.hide(),R.load(function(){s.storageLoaded=!0,_()}),$("body").append(R),s.storage=R}else _();this.startInternal=function(e){try{N=new o2.chat.Logger(P,A),null!==h&&(A.setConnection(h),Ae()),m=e?e.customerGroup:null,j();var t=o2.chat.Util.getUrlParameters();if(o2.chat.Util.getActiveWindowStatus()||null===h&&null!==d&&(h=d),d&&xe(d),0===i.openDepartments.length)D.triggered||(ee(o2.chat.ErrorCode.ALL_DEPARTMENTS_CLOSED),Ce("dialogPosition","openDialog"));else if(D.triggered)D.triggered=!1,window.setTimeout(Ue,i.invitationPopUpConfig.displayDurationInMs),x||(x=new o2.chat.AdServerConnector(i.invitationPopUpConfig)),x.promise.then(function(){s.layout.find('*[o2chat-content="invitation.message"]').html(x.value),n.showPanel("invitation"),Ce("dialogPosition","openDialog")})["catch"](te);else if("nk"!==t.cg&&"bk"!==t.cg||!t.sn||h)if(h){if(p)return;p=!0,A.getChatTranscript(function(e){if(e&&e.error&&e.error.code==o2.chat.ErrorCode.NO_OPEN_CHAT.code&&e.error.code==o2.chat.ErrorCode.INVALID_CHAT_ID.code)return p=!1,h=null,we("connection"),!1;if(e.transcript){if(e.transcript.initialQuestion&&V({agentMessage:!1,content:""+e.transcript.initialQuestion,nickname:""+e.transcript.userNickname},!0),e.transcript.messages)for(var t=Array.isArray(e.transcript.messages.message)?e.transcript.messages.message:[e.transcript.messages.message],o=0;o<t.length;o++)V(t[o],!0);De("chat.close").show(),W(),o2.chat.Util.setActiveWindow(),window.onbeforeunload=function(){o2.chat.Util.setDeactiveWindow()},n.showPanel("chat"),ke("chat.question").focus(500),Ce("dialogPosition","openDialog")}he()&&se()})}else if(d)xe(d);else{var o=o2.chat.Util.getUrlParameter("source");o||(o="link"),me("start",{startedFrom:o}),n.showPanel("customerGroup"),!e||"nk"!==e.customerGroup&&"bk"!==e.customerGroup?i.preSelection?(De("login.button.cancel").toggle("bk"!==i.preSelection),ae(i.preSelection)):!e||"nk"!==e.customerGroupLoginRedirect&&"bk"!==e.customerGroupLoginRedirect?(De("login.button.cancel").show(),ue()&&ce()):ae(e.customerGroupLoginRedirect):(De("login.button.cancel").toggle("bk"!==e.customerGroup),ae(e.customerGroup)),Ce("dialogPosition","openDialog")}else if(d)xe(d);else{for(var r=0;r<i.customerGroups.length;r++)i.customerGroups[r].preselectionKey===t.cg&&(f=i.customerGroups[r]);De("login.button.cancel").toggle("bk"!==f.preselectionKey);var a=t.sn,c=o2.chat.Chat.findDepartmentNameForServiceName(i.departments,a);null!==c?o2.chat.Chat.checkIfDepartmentIsOpen(i,c)?(f.serviceName=a,f.topicKey="bk"==f.preselectionKey?"Kundenbetreuung":"Interessent",g.topic="DirectLink",ie(!0)):ee(o2.chat.ErrorCode.ALL_DEPARTMENTS_CLOSED):(f.serviceName=null,ie(!1)),Ce("dialogPosition","openDialog")}}catch(l){te(l)}};var j=function(){try{if(s.initialized)return ke("personalData.name").val(""),ke("personalData.phone").val(""),ke("personalData.topic").val(""),ke("personalData.question").val(""),ke("chat.question").val(""),ke("chat.question").prop("disabled",!1),De("chat.send").prop("disabled",!1),void be("chat.messages").find("[o2chat-tmp]").remove();var e=s.layout;for(var t in i.content)if(i.content.hasOwnProperty(t)){e.find('*[o2chat-content="'+t+'"]').html(i.content[t]);var o="{o2chat-content:"+t+"}";e.find("*").each(function(e,n){$.each(n.attributes,function(){this.value===o&&(this.value=i.content[t])})})}De("chat.logout").hide(),De("chat.logout").click(function(){["personalData.topic","personalData.question"].forEach(function(e){o2.chat.SessionStorage.setProperty(e,ke(e).val())});var e=location.search?location.href.replace(location.search,""):location.href,t=o2.chat.Util.getUrlParameters();t["cg-redirect"]=f?f.preselectionKey:o2.chat.Util.getUrlParameter("cg-redirect"),e+="?"+$.param(t);var o=i.loginConfig.logoutURL+"?goto="+encodeURIComponent(e);$(location).attr("href",o)}),P.loginSupported&&u.invoke().then(function(){De("chat.logout").toggle(u.loggedIn)}),De("invitation.start").click(function(){n.showPanel("customerGroup")}),ke("personalData.question").keyup(function(){be("personalData.questionCharactersLeft").text(300-$(this).val().length)}),De("personalData.openChat").click(function(){z()}),De("personalData.genericGreeting.loginButton").click(function(){ce()}),A.useSSL?be("personalData.sslIcon").popover({content:function(){return Pe("personalData.sslIconTooltip")},html:!0,placement:"auto bottom",trigger:"hover"}):be("personalData.sslIcon").hide(),ne(),ke("chat.question").keyup(function(){be("chat.questionCharactersLeft").text(300-$(this).val().length)}),ke("chat.question").keydown(function(e){if(13===e.keyCode)return e.preventDefault(),e.stopImmediatePropagation(),n.changeTitleAfterClicking(),n.changeFaviconAfterClicking(),K(),!1}),De("chat.send").click(function(){n.changeTitleAfterClicking(),n.changeFaviconAfterClicking(),K()}),ke("chat.question").click(function(){n.changeTitleAfterClicking(),n.changeFaviconAfterClicking()}),De("chat.pkkCheckLink").click(function(){Ie("chat.pkkCheck.error").hide(),se()}),De("chat.generatePdf").click(function(e){if(A){var t=A.getPdfUrl();t&&(window.location=t)}return e.preventDefault(),e.stopPropagation(),!1}),be("chat.agentMessage").hide(),be("chat.userMessage").hide(),be("chat.downloadLink").hide(),Ie("chat.fileupload.container").hide(),Ie("chat.fileupload.form").hide(),Ie("chat.fileupload.error.nofile").hide(),Ie("chat.fileupload.progressbar").hide(),Ie("chat.fileupload.success").hide();var r=Ie("chat.fileupload.form");r.prop("action","javascript:;"),r.prop("enctype","multipart/form-data"),r.prop("method","POST"),r.submit(Y),Ie("chat.login.error").toggle(ue());var a=ke("login.input.username");a.prop("name","IDToken1");var c=ke("login.input.password");c.prop("name","IDToken2"),De("login.button.ok").click(function(e){["personalData.name","personalData.phone","personalData.topic","personalData.question"].forEach(function(e){o2.chat.SessionStorage.setProperty(e,ke(e).val())})}),De("login.button.cancel").click(function(e){Ie("chat.login.error").hide(),n.showPreviousPanel()}),Ie("chat.pkkCheck.error").toggle(he());var l=ke("pkkCheck.input.password");l.prop("name","IDToken1"),De("pkkCheck.button.cancel").click(function(e){n.showPreviousPanel()}),De("overlay-title.close").click(M),De("chat.close").click(M),De("chat.close").hide(),De("close.yes").click(function(){D.closedPermanently=!0,n.closeConfirmed(i,null)}),De("close.no").click(H),De("error.ok").click(G),B(),s.initialized=!0}catch(h){te(h)}};n.changeTitleAfterClicking=function(){y=0,window.document.title=n.findContentElement("general.header")},n.changeFaviconAfterNewMessage=function(){var e=document.querySelector("link[rel*='icon']")||document.createElement("link");e.rel="shortcut icon",1===o2.chat.integration.test.O2.getBrandId()?e.href="./img/o2alert.png":2===o2.chat.integration.test.O2.getBrandId()&&(e.href="./img/blaualert.png"),document.getElementsByTagName("head")[0].appendChild(e)},n.changeFaviconAfterClicking=function(){var e=document.querySelector("link[rel*='icon']")||document.createElement("link");e.rel="shortcut icon",1===o2.chat.integration.test.O2.getBrandId()?e.href="http://static.o9.de/resources/v=0.201.0/img/favicon.png":2===o2.chat.integration.test.O2.getBrandId()&&(e.href="https://static-blau.o9.de/resources/v=0.201.0/img/favicon.png"),document.getElementsByTagName("head")[0].appendChild(e)};var M=function(){n.changeFaviconAfterClicking(),n.changeTitleAfterClicking();try{if(null!==h){var e=Z();"close"!==e&&(n.showPanel("close"),me("closing"))}else n.closeConfirmed(i,null)}catch(t){te(t)}};this.closeConfirmed=function(e,t){try{q();var o=null;o=null!==t?t.layout:s.layout,n.changeFaviconAfterClicking(),n.changeTitleAfterClicking(),o2.chat.Util.removeActiveWindowStatus(),P.embedded?o.hide():e.customerSurvey.active?(o.find('*[o2chat-content="survey.message"]').html(e.customerSurvey.displayText),o.find("#survey-link").prop("href",e.customerSurvey.surveyURL),n.showPanel("survey")):n.showPreviousPanel(),we("dialogPosition"),"invitation"===Z()&&(D.closedPermanently=!0),me("closed")}catch(r){te(r)}};var H=function(){n.showPreviousPanel(),"chat"===Z()&&ke("chat.question").focus(),me("closeCancelled")},G=function(){if(v===o2.chat.ErrorCode.CUSTOMER_NOT_AUTHORIZED.code&&P.loginSupported){for(;k.length>0&&"customerGroup"!==k[k.length-1];)k.pop();ce()}else v===o2.chat.ErrorCode.AJAX.code||v===o2.chat.ErrorCode.CONNECTION_PROBLEM.code?(b++,w=0,W(),n.showPreviousPanel()):n.showPreviousPanel()},q=function(){if(h){ke("chat.question").prop("disabled",!0),De("chat.send").prop("disabled",!0),De("chat.close").hide(),De("chat.pkkCheckLink").hide();var e=h;h=null,A.closeChat(),we("connection"),me("disconnected",{connection:e})}},B=function(){P.embedded&&(s.layout.draggable({cursor:"move",handle:".panel-heading",containment:"window"}).css({position:"fixed"}),new o2.chat.TouchDragger(n,s.layout.find(".panel-heading")),s.layout.bind("dragstop",function(){var e=$(this),t=e.position();t.left<0&&(t.left=0,e.css("left","0")),t.top<0&&(t.top=0,e.css("top","0")),e.css("height",""),ye("dialogPosition",t),me("dialogMoved",t)}))},F=function(){var e=!0;for(var t in c.personalData)if(c.personalData.hasOwnProperty(t)){var o=ke("personalData."+t);if(o.is(":visible")){var r=Ie("personalData."+t),a=o.val().trim();if(c.personalData[t].regexp.test(a))r.removeClass("has-error"),"function"==typeof o.popover&&o.popover("destroy");else{if(r.addClass("has-error"),c.personalData[t].hasOwnProperty("errmsg")&&"function"==typeof o.popover&&o.popover({content:n.findContentElement(c.personalData[t].errmsg),html:!0,placement:"bottom",trigger:"focus",animation:!1}),e){var i=o;i.focus()}e=!1}}}return e},z=function(){if(!F())return!1;De("personalData.openChat").prop("disabled",!0),Ie("personalData.name").is(":visible")&&(g.name=ke("personalData.name").val().trim()),Ie("personalData.phone").is(":visible")&&(g.phone=ke("personalData.phone").val().trim()),Ie("personalData.topic").is(":visible")&&(g.topic=ke("personalData.topic").val()),Ie("personalData.question").is(":visible")&&(g.question=ke("personalData.question").val().trim());var e=null==f.serviceName?fe(g.topic):ge(),t={departmentId:e,config:"/siteconfig/handy/?view=config.xml",userNickname:g.name,topic:f.topicKey,subTopic:g.topic,initialQuestion:g.question,phone:g.phone};return J({agentMessage:!1,content:g.question,nickname:g.name,timestamp:(new Date).getTime()}),A.openChat(t,l,function(e){e.error||(t.chatId=e.chatId,t.pollingInformation=e.pollingInformation,void 0===t.pollingInformation.pollingInterval?t.pollingInformation.pollingInterval=1e3:t.pollingInformation.pollingInterval<1e3&&(t.pollingInformation.pollingInterval*=1e3),Ie("chat.pkkCheckLink").toggle(t.pollingInformation.authorizationLevel===u.AUTH_WITH_LOGIN),me("connected",{connection:t}),ye("connection",t),o2.chat.Util.setActiveWindow(),window.onbeforeunload=function(){o2.chat.Util.setDeactiveWindow()},h=t,Ae(),De("chat.close").show(),W(),n.showPanel("chat"),ke("chat.question").focus(500))}),!0},K=function(){var e=ke("chat.question"),t=$.trim(e.val());e.val(""),e.keyup(),t&&(J({agentMessage:!1,content:t,nickname:h.userNickname,timestamp:(new Date).getTime()}),n.sendMessage(t))},Q=function(){w++,setTimeout(function(){W()},E)},W=function(){null!==h&&A.getMessages(function(e){try{if(e&&e.messages){var t=h&&h.pollingInformation&&h.pollingInformation.isLoggedIn,o=e.messages.authorizationLevel>=u.AUTH_WITH_LOGIN,r=e.messages.authorizationLevel===u.AUTH_WITH_LOGIN;if(Ie("chat.pkkCheckLink").toggle(t&&r),De("chat.logout").toggle(o),e.messages.message){for(var a=Array.isArray(e.messages.message)?e.messages.message:[e.messages.message],i=0;i<a.length;i++)V(a[i]),y++;window.document.title="("+y+") "+n.findContentElement("general.header.new.messages"),n.changeFaviconAfterNewMessage()}w>0?w=0:null,b>0?b=0:null}null!==h&&setTimeout(function(){W()},h.pollingInformation.pollingInterval)}catch(c){te(c)}})},V=function(e,t){e.content=String(e.content),me("messageReceived",{message:e}),0===e.content.indexOf("/{")?L.handleCommand(JSON.parse(e.content.substring(1)),t):J(e,t)},J=function(e,t){var o=be("chat.messages"),n=e.agentMessage?be("chat.agentMessage").clone():be("chat.userMessage").clone();n.removeAttr("o2chat-ph"),n.attr("o2chat-tmp","true"),e.agentMessage||t?(n.find('*[o2chat-ph="chat.messageSender"]').html(e.nickname),n.find('*[o2chat-ph="chat.messageText"]').html(e.content)):(n.find('*[o2chat-ph="chat.messageSender"]').text(e.nickname),n.find('*[o2chat-ph="chat.messageText"]').text(e.content)),n.show(),S&&S.finish();var r=o.scrollTop()+o.outerHeight()>=o[0].scrollHeight;o.append(n),e.agentMessage&&!r||(S=o.animate({scrollTop:o[0].scrollHeight},"slow"))},X=function(e,t){var o=be("chat.messages"),n=be("chat.downloadLink").clone();n.removeAttr("o2chat-ph");var r=n.find('*[o2chat-ph="chat.downloadAnchor"]');r.prop("href",A.getBaseUrl()+"customer-download/"+e),r.append(document.createTextNode(t)),n.show(),o.append(n),o.animate({scrollTop:o[0].scrollHeight},"slow")},Y=function(e){var t=Ie("chat.fileupload.container"),o=Ie("chat.fileupload.form"),r=Ie("chat.fileupload.error.nofile"),a=Ie("chat.fileupload.progressbar"),i=Ie("chat.fileupload.success"),c=ke("chat.fileupload.file");return c.val()?(r.hide(),o.hide(),a.show(),e.preventDefault(),$.ajax({xhr:function(){var e=new window.XMLHttpRequest;return e.withCredentials=!0,e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;t=parseInt(100*t),a.css("width",t+"%"),a.text(t+"%")}},!1),e},url:A.getBaseUrl()+"upload-customer",type:"POST",data:new FormData(o[0]),dataType:"json",processData:!1,contentType:!1,success:function(e){a.hide(),i.show(),t.delay(5e3).slideUp(),n.sendMessage({type:"CustomerToAgentFileSendCompleteResponse",uuid:e.result.value})},error:function(e){a.hide()}}),!1):(c.parents("div").eq(0).addClass("has-feedback has-error"),void r.show())};this.showPanel=function(e){k.push(e),s.layout.find("*[o2chat-panel]").hide(),Te(e).show(),me("showPanel",{panel:e})},this.showPreviousPanel=function(){if(k.pop(),0===k.length)P.embedded&&s.layout.hide(),P.standalone&&window.close();else{var e=k[k.length-1];s.layout.find("*[o2chat-panel]").hide(),Te(e).show(),me("showPanel",{panel:e})}};var Z=function(){return k[k.length-1]},ee=function(e,t){e instanceof o2.chat.ErrorCode&&(e=e.code),v=e,v===o2.chat.ErrorCode.CHAT_ALREADY_ACTIVE.code&&De("error.ok").hide(),s.initialized?"error"!==Z()&&(be("error.errorCode").text(e),be("error.errorMessage").text(i.content["error.code"+e]),n.showPanel("error"),s.layout.is(":visible")||Ce("dialogPosition","openDialog")):(r.popover({content:P.messages.genericErrorMessage,html:!0,placement:"bottom",trigger:"manual",animation:!1}),r.popover("show")),"undefined"==typeof t&&(t=P.fatalErrorCodes.indexOf(o2.chat.ErrorCode.fromCode(e))<0),me("showErrorPanel",{code:e,keepAlive:t}),t?h&&(ke("chat.question").prop("disabled",!1),De("chat.send").prop("disabled",!1)):(ke("chat.question").prop("disabled",!0),De("chat.send").prop("disabled",!0),q())},te=function(e){me("error",{value:e}),s.layout&&i&&i.promise.isFulfilled()&&(e.request&&e.request.httpError?w>C?(ee(b<T?o2.chat.ErrorCode.AJAX:o2.chat.ErrorCode.CONNECTION_PROBLEM),setTimeout(function(){W()},E)):Q():e.request&&e.request.status<100?ee(e.request.status):ee(o2.chat.ErrorCode.GENERIC,!1)),De("personalData.openChat").prop("disabled",!1),N&&(e instanceof Error?N.logException(e):e.request&&N.logRequestError(e.request))},oe=function(e){null!==r&&(e?(null!==P.init["class"].active&&r.addClass(P.init["class"].active),null!==P.init["class"].inactive&&r.removeClass(P.init["class"].inactive)):(null!==P.init["class"].active&&r.removeClass(P.init["class"].active),null!==P.init["class"].inactive&&r.addClass(P.init["class"].inactive))),me("initialized",{active:e})},ne=function(){var e=i.customerGroups,t=e.length;!P.loginSupported&&t>1&&(t=1);for(var o=be("customerGroup.container"),n=be("customerGroup.template"),r=be("invitation.container"),a=be("invitation.template"),c=0;c<t;c++){var s=n.clone(),l=s.find("*").andSelf().filter('[o2chat-action="customerGroup.select"]');if(l.click(ae),l.data("o2.chat.customerGroup",e[c]),s.html(Pe("customerGroup.option"+(c+1))),o.append(s),!i.preSelection||i.preSelection===e[c].preselectionKey){var u=a.clone();l=u.find("*").andSelf().filter('[o2chat-action="invitation.select"]'),l.click(pe),l.data("o2.chat.customerGroup",e[c]),u.html(Pe("customerGroup.option"+(c+1))),r.append(u)}}},re=function(){var e="desktop"===l?i.selectedDepartmentBigScreen:i.selectedDepartmentSmallScreen,t=i.departments,o=null,n=-1,r=[],a=0,c=0;if(null===f)throw"IllegalStateException: customerGroup === null";for(t=o2.chat.Chat.filterDepartmentsByDeviceType(t,l),a=0;a<t.length;a++)if(t[a].name===e){o=t[a],n=a;break}if(o&&void 0!==o.topics[f.topicKey]&&null!==o.topics[f.topicKey]&&i.openDepartments.indexOf(o.name)>=0)for(a=0;a<o.topics[f.topicKey].length;a++)r.push(o.topics[f.topicKey][a]);for(a=0;a<t.length;a++)if(i.openDepartments.indexOf(t[a].name)>=0&&a!==n&&void 0!==t[a].topics[f.topicKey]&&null!==t[a].topics[f.topicKey])for(c=0;c<t[a].topics[f.topicKey].length;c++)r.push(t[a].topics[f.topicKey][c]);var s=ke("personalData.topic"),u=ke("personalData.topicTemplate");if(s.find('*[o2chat-generated="true"]').remove(),0===r.length)throw new o2.chat.NoTopicsException;for(a=0;a<r.length;a++){var h=u.clone();h.prop("value",r[a]),h.attr("o2chat-generated","true"),h.removeAttr("o2chat-data"),h.text(r[a]),s.append(h)}},ae=function(e){try{var t=null;if("object"==typeof e){var o=e;t=$(o.target).closest('[o2chat-action="customerGroup.select"]').data("o2.chat.customerGroup")}else{if("string"!=typeof e)throw"illegal type";for(var n=0;n<i.customerGroups.length;n++)i.customerGroups[n].preselectionKey===e&&(t=i.customerGroups[n])}if(!me("customerGroupSelected",{customerGroup:t}))return;f=t,f.serviceName=null,ie(!1)}catch(r){r instanceof o2.chat.NoTopicsException?ee(o2.chat.ErrorCode.ALL_DEPARTMENTS_CLOSED):te(r)}},ie=function(e){var t;t=P.loginSupported?u.invoke():o2.chat.Q.when([]),t.then(function(t){if("fulfilled"===t[0].state&&"rejected"===t[1].state&&t[1].reason.responseJSON&&"No AOL customer allowed"===t[1].reason.responseJSON.message)ee(o2.chat.ErrorCode.GENERIC);else{if(e&&(De("personalData.genericGreeting.loginButton").toggle("nk"!==f.preselectionKey),"nk"===f.preselectionKey&&(1===o2.chat.integration.test.O2.getBrandId()?Se("personalData.genericGreeting.text").html("Hallo! <br/><br/> Herzlich willkommen im O<sub>2</sub> Live-Chat. Unsere Mitarbeiter freuen sich auf den Dialog mit dir!"):2===o2.chat.integration.test.O2.getBrandId()&&Se("personalData.genericGreeting.text").html("Hallo! <br/><br/> Herzlich willkommen im Blau Live-Chat. Unsere Mitarbeiter freuen sich auf den Dialog mit dir!"))),"bk"===f.preselectionKey&&!u.loggedIn)return void ce();De("chat.logout").toggle(u.loggedIn),u.loggedIn?(g.name=u.firstName+" "+u.lastName,P.showPersonalData.name=!1,P.showPersonalData.phone=!1,be("customer.firstName").text(u.firstName),be("customer.lastName").text(u.lastName),Ie("chat.pkkCheckLink").toggle(u.authorizationLevel===u.AUTH_WITH_LOGIN),1===o2.chat.integration.test.O2.getBrandId()?Se("personalData.customerGreeting.text").html("Herzlich willkommen im O<sub>2</sub> Live-Chat. Unsere Mitarbeiter freuen sich auf den Dialog mit dir!<br/><br/>"):2===o2.chat.integration.test.O2.getBrandId()&&Se("personalData.customerGreeting.text").html("Herzlich willkommen im Blau Live-Chat. Unsere Mitarbeiter freuen sich auf den Dialog mit dir!<br/><br/>"),Ie("personalData.genericGreeting").hide(),Ie("personalData.customerGreeting").show()):(P.showPersonalData.name=!0,P.showPersonalData.phone=!0,Ie("chat.pkkCheckLink").hide(),Ie("personalData.customerGreeting").hide(),Ie("personalData.genericGreeting").show()),e?P.showPersonalData.topic=!1:re();for(var o in f.showPersonalData)if(f.showPersonalData.hasOwnProperty(o)){var r=f.showPersonalData[o];P.showPersonalData[o]===!1?r=!1:P.showPersonalData[o]===!0&&(r=!0),Ie("personalData."+o).toggle(r)}if(le()){var a=["personalData.name","personalData.phone","personalData.question"];e||a.push("personalData.topic"),a.forEach(function(e){o2.chat.SessionStorage.hasProperty(e)&&ke(e).val(o2.chat.SessionStorage.getAndRemoveProperty(e))})}n.showPanel("personalData"),ke("personalData.topic").change(function(){var e=ke("personalData.topic").val();me("topicSelected",{topic:e})}),ue()&&ce()}})["catch"](function(e){e instanceof o2.chat.NoTopicsException?ee(o2.chat.ErrorCode.ALL_DEPARTMENTS_CLOSED):te(e)})},ce=function(){var e=o2.chat.Util.getUrlParameters();e.cg=m,e["cg-redirect"]=f?f.preselectionKey:o2.chat.Util.getUrlParameter("cg-redirect"),delete e["chat-loginfailed"];var t=location.search?location.href.replace(location.search,"?"):location.href+"?";t+=$.param(e);var o=o2.chat.Util.getUrlParameters();o.cg=m,o["cg-redirect"]=f?f.preselectionKey:o2.chat.Util.getUrlParameter("cg-redirect"),o["chat-loginfailed"]="true";var r=location.search?location.href.replace(location.search,"?"):location.href+"?";r+=$.param(o);var a=i.loginConfig.loginURL+"?redir_on_fail=true&goto="+encodeURIComponent(t)+"&gotoOnFail="+encodeURIComponent(r),c=Ie("chat.customer-login.form");c.prop("action",a),c.prop("method","POST"),n.showPanel("login")},se=function(){var e=o2.chat.Util.getUrlParameters();delete e["chat-pkkcheckfailed"];var t=location.search?location.href.replace(location.search,"?"):location.href+"?";t+=$.param(e);var o=o2.chat.Util.getUrlParameters();o["chat-pkkcheckfailed"]="true";var r=location.search?location.href.replace(location.search,"?"):location.href+"?";r+=$.param(o);var a=i.loginConfig.pkkCheckURL+"?redir_on_fail=true&goto="+encodeURIComponent(t)+"&gotoOnFail="+encodeURIComponent(r),c=Ie("chat.customer-pkkcheck.form");c.prop("action",a),c.prop("method","POST"),n.showPanel("pkkCheck")},le=function(){return void 0!==o2.chat.Util.getUrlParameter("cg-redirect")},ue=function(){return"true"===o2.chat.Util.getUrlParameter("chat-loginfailed")},he=function(){return"true"===o2.chat.Util.getUrlParameter("chat-pkkcheckfailed")},pe=function(e){D.closedPermanently=!0,s&&s.layout&&s.layout.hide();var t=$(e.target).closest('[o2chat-action="invitation.select"]').data("o2.chat.customerGroup");de({cg:t.preselectionKey,source:"invitation"})};this.startChatButtonClicked=function(){D.closedPermanently=!0,s&&s.layout&&s.layout.hide(),de({source:"button"})};var de=function(e){var t=P.chatPageUrl,o=o2.chat.Util.getUrlParameters();e=e?e:{},e.cfgpath=location.pathname;for(var n in o)0===n.indexOf("chat-")&&o.hasOwnProperty(n)&&(e[n]=o[n]);for(var n in e)e.hasOwnProperty(n)&&(t+=t.indexOf("?")>0?"&":"?",t=t+encodeURIComponent(n)+"="+encodeURIComponent(e[n]));window.open(t,"_blank","width=700,height=700,scrollbars=yes")},fe=function(e){var t=null;return $.each(i.departments,function(o,n){void 0!==n.topics[f.topicKey]&&$.each(n.topics[f.topicKey],function(o,r){r===e&&(t=n.name)})}),t},ge=function(){var e=null;return $.each(i.departments,function(t,o){o.serviceName===f.serviceName&&(e=o.name)}),e},me=function(e,t){var o=[],r=0;if(o=o.concat(ve(e)),o=o.concat(ve("any")),0!==o.length){var a=new o2.chat.Event(e,n,t);for(r=0;r<o.length;r++){var i="function"==typeof o[r]?o[r]:o[r].onEvent,c=i(a);if(void 0!==c&&c===!1)return!1;if(a.isStopPropagation())break}return!0}},ve=function(e){var t=[],o=0;if(void 0!==P.eventListeners[e])if(Array.isArray(P.eventListeners[e]))for(o=0;o<P.eventListeners[e].length;o++)t.push(P.eventListeners[e][o]);else t.push(P.eventListeners[e]);return t},ye=function(e,t){Ee({method:"set",key:P.storage.prefix+e,data:t})},we=function(e){Ee({method:"remove",key:P.storage.prefix+e})},Ce=function(e,t){Ee({method:"get",key:P.storage.prefix+e,callback:t})},Ee=function(e){s.storage.get(0).contentWindow.postMessage(JSON.stringify(e),"*")};I.openDialog=function(e){e.sessionData&&P.embedded&&s.layout.css(e.sessionData),window.setTimeout(function(){me("showLayout"),n.switchSpinner();var e=be("chat.messages");e.length>0&&e.animate({scrollTop:e[0].scrollHeight},"slow")},1500)},I.connection=function(e){e.sessionData?(h=e.sessionData,null!==A&&(A.setConnection(h),Ae())):e.localData&&(d=e.localData)};var be=function(e){return s.layout.find('*[o2chat-ph="'+e+'"]')},Te=function(e){return s.layout.find('*[o2chat-panel="'+e+'"]')},ke=function(e){return s.layout.find('*[o2chat-data="'+e+'"]')};this.findContentElement=function(e){return i.content[e]};var Se=function(e){return s.layout.find('*[o2chat-content="'+e+'"]')},De=function(e){return s.layout.find('*[o2chat-action="'+e+'"]')},Ie=function(e){return s.layout.find('*[o2chat-container="'+e+'"]')},Pe=function(e){return i.content[e]};this.loadLayoutTemplate=function(){try{var e=o2.chat.Q.defer();return null===s.layout?null!==P.templates.layout?"string"==typeof P.templates.layout?$.ajax(P.templates.layout,{dataType:"html",success:function(t){var o=$("body"),n=$(t);o.append(n),n.hide(),s.layout=n,P.embedded&&s.layout.css({width:"500px","z-index":"1000",left:"150px",top:"50px"}),e.resolve()},error:function(e,t,o){r.popover({content:P.templates.layoutErrorMessage,html:!0,placement:"bottom",trigger:"manual",animation:!1}),r.popover("show")}}):P.templates.layout instanceof jQuery&&(s.layout=P.templates.layout,e.resolve()):(s.layout=$("<span></span>"),e.resolve()):(P.embedded&&s.layout.css({left:"150px",top:"50px"}),e.resolve()),e.promise}catch(t){te(t)}};var Oe=function(){null!==s.layout&&s.layout.is(":visible")||D.closedPermanently||"smartphone"!==l&&(P.standalone||r.filter(":visible").length&&(D.showTimeoutId=0,D.triggered=!0,n.openDialog()))},Ue=function(){"invitation"===Z()&&(s.layout.hide(),D.counter+1<i.invitationPopUpConfig.displayIntervalsInMs.length&&(D.counter++,D.currentDelay=i.invitationPopUpConfig.displayIntervalsInMs[D.counter],D.showTimeoutId=window.setTimeout(Oe,D.currentDelay)))},Ae=function(){if(s.layout&&A){var e=De("chat.generatePdf"),t=A.getPdfUrl();t?e.hide():e.hide()}},xe=function(e){A.setConnection(e),Ae(),A.isActive(function(t){t.status.value?o2.chat.Util.getActiveWindowStatus()?(ee(o2.chat.ErrorCode.CHAT_ALREADY_ACTIVE),Ce("dialogPosition","openDialog")):null===h&&null!==e&&(h=e):(we("connection"),n.showPanel("customerGroup"),
!param||"nk"!==param.customerGroup&&"bk"!==param.customerGroup?i.preSelection?(De("login.button.cancel").toggle("bk"!==i.preSelection),ae(i.preSelection)):De("login.button.cancel").show():(De("login.button.cancel").toggle("bk"!==param.customerGroup),ae(param.customerGroup)),Ce("dialogPosition","openDialog"))})};this.switchSpinner=function(){$("#spinner").hide(),$("#content-container").show()},this.openDialog=function(e){if("function"==typeof r.popover&&r.popover("destroy"),null===s.layout||!s.layout.is(":visible")){k=[];try{var t=n.loadLayoutTemplate();t.then(function(){var t,o=0;i&&i.initialized?t=i.refreshOpenDepartments().promise:(i=new o2.chat.BoConfiguration({connector:U}),t=i.promise,i.promise.then(function(){me("backofficeConfigurationLoaded",{configuration:i})})["catch"](te));var r=[t];if("undefined"==typeof jQuery.ui){var a=o2.chat.Q.defer();r.push(a.promise),$.ajax({url:P.dependencies.jQueryUI,dataType:"script",cache:!0,success:function(){a.resolve()}})}if(Array.isArray(P.init.externalPromises))for(o=0;o<P.init.externalPromises.length;o++)"object"==typeof P.init.externalPromises[o]&&r.push(P.init.externalPromises[o]);o2.chat.Q.allSettled(r).then(function(){n.startInternal(e)})["catch"](te)})["catch"](te)}catch(o){te(o)}}},this.sendMessage=function(e){try{if("object"==typeof e)A.sendMessage("/"+JSON.stringify(e),function(){h&&(ke("chat.question").prop("disabled",!1),De("chat.send").prop("disabled",!1),ke("chat.question").focus())});else if(me("messageSent",{message:{content:e}}),ke("chat.question").prop("disabled",!0),De("chat.send").prop("disabled",!0),A.sendMessage(e,function(){h&&(ke("chat.question").prop("disabled",!1),De("chat.send").prop("disabled",!1),ke("chat.question").focus())}),"***exception"===e){var t;t.thisIsNotAMethod()}}catch(o){te(o)}},this.processFileDownload=function(e,t){X(e,t)},this.showFileUploadContainer=function(){var e=Ie("chat.fileupload.container");e.is("visible")||(Ie("chat.fileupload.form").show(),Ie("chat.fileupload.progressbar").hide(),Ie("chat.fileupload.success").hide(),e.show())},this.debug=function(e){o&&o.debug(e)},this.logMessage=function(e){N&&N.logMessage(e)},this.logException=function(e){N&&N.logException(e)},this.logRequestError=function(e){N&&N.logRequestError(e)},this.addEventListener=function(e,t){P.eventListeners[e]?Array.isArray(P.eventListeners[e])||(P.eventListeners[e]=[P.eventListeners[e]]):P.eventListeners[e]=[],P.eventListeners[e].push(t)};var Ne=function(){throw"Unsupported operation"};Object.defineProperties(this,{customerData:{get:function(){return g},set:Ne,enumerable:!0},options:{get:function(){return P},set:Ne,enumerable:!0},data:{get:function(){return O},set:Ne,enumerable:!0},boConfiguration:{get:function(){return i},set:Ne,enumerable:!0}})},o2.chat.Chat.filterDepartmentsByDeviceType=function(e,t){return e=e.filter(function(e){return e.deviceType===t})},o2.chat.Chat.findDepartmentNameForServiceName=function(e,t){for(var o=null,n=0;n<e.length;n++)if(e[n].serviceName===t){o=e[n].name;break}return o},o2.chat.Chat.checkIfDepartmentIsOpen=function(e,t){return e.openDepartments.indexOf(t)>=0},function(e){"use strict";e.fn.o2chat=function(t){var o=e(this).data(o2.chat.dataPropertyName);if(o)return o;var n=this.each(function(){var n=e(this);try{o=new o2.chat.Chat(n,t)}catch(r){}n.data(o2.chat.dataPropertyName,o)});return n}}(jQuery);var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.ChatServiceConnector=function(e,t){"use strict";var o=e.brandId,n=e.serviceHost,r=e.timeout,a=e.useSSL||"https:"===location.protocol;this.useSSL=a;var i=this,c=null,s=function(){},l=function(){},u=function(){return Math.random().toString().slice(2,12)};this.openChat=function(e,t,n){var r={};c=e;for(var a in e)e.hasOwnProperty(a)&&(r["o2ChatService-"+a]=e[a]);return r["o2ChatService-version"]=2,r["o2ChatService-deviceType"]=t,r["o2ChatService-brandId"]=o,p("openchat",r,n)},this.isActive=function(e){return p("isactive",{},e)},this.sendMessage=function(e,t){p("sendmessage",{"o2ChatService-message":e},t)},this.getMessages=function(e){return p("getmessages",{},e)},this.getChatTranscript=function(e){return p("getchattranscript",{},e)},this.closeChat=function(e){var t=p("closechat",{},e);return c=null,t},this.logMessage=function(e,t){return h("logMessage",e,null,t)},this.logException=function(e,t,o){return h("logException",e,{stacktrace:t},o)},this.logRequestError=function(e,t,o){return h("logRequestError",e,{request:t},o)},this.logAlive=function(e,t,o){var n={"o2ChatService-callId":e,"o2ChatService-debug":t};return p("alive",n,o,l)},this.getPdfUrl=function(){return c&&c.pollingInformation&&c.pollingInformation.chatId?i.getBaseUrl()+"pdf?o2ChatService-chatId="+encodeURIComponent(c.pollingInformation.chatId):null},this.getDeviceType=function(e){return p("devicetype",{},e)},this.getAuthorizationLevel=function(e){return p("authlevel",{},e)};var h=function(e,t,o,n){var r={"o2ChatService-message":t};if(o)for(var a in o)o.hasOwnProperty(a)&&("object"==typeof o[a]?r["o2ChatService-"+a]=JSON.stringify(o[a]):r["o2ChatService-"+a]=o[a]);return p(e,r,n,l)},p=function(e,o,n,a){var l=i.getBaseUrl()+e,h="JSON",p="GET",d=a?a:t;n||(n=s),"openchat"!==e&&"sendmessage"!==e&&"logMessage"!==e&&"logException"!==e&&"logRequestError"!==e||(p="POST"),o["o2ChatService-callId"]||(o["o2ChatService-callId"]=u());var f=$.ajax(l,{type:p,dataType:h,data:o,timeout:r,xhrFields:{withCredentials:!0},success:function(t){if(t&&t.error&&$.isNumeric(t.error.code)){var r=n(t);if("boolean"==typeof r&&!r)return;if(!c&&("getmessages"===e||"sendmessage"===e||"getchattranscript"===e))return;d(l,p,h,o,t.error.code,t.error.message,!1)}else n(t)},error:function(t,n,r){"logMessage"!==e&&"logException"!==e&&"logRequestError"!==e&&d(l,p,h,o,t.status,t.statusText,!0,n)}});return f};this.setConnection=function(e){c=e},this.getBaseUrl=function(){var e=a?"https:":"http:";return e+"//"+n+"/o2-chat-service/"}};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.CommandHandlers=function(e){"use strict";var t=e,o={};this.handleCommand=function(e){o.hasOwnProperty(e.type)&&"function"==typeof o[e.type]&&o[e.type](e)},o.WebRTCCapabilitiesRequest=function(e,o){o||t.sendMessage({type:"WebRTCCapabilitiesResponse",webRtc:!!navigator.getUserMedia||!!navigator.webkitGetUserMedia||!!navigator.mozGetUserMedia})},o.AgentToCustomerFileSendRequest=function(e,o){t.processFileDownload(e.uuid,e.name)},o.CustomerToAgentFileSendRequest=function(e,o){o||(t.showFileUploadContainer(),t.sendMessage({type:"CustomerToAgentFileSendProgressResponse"}))}};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.CustomerData=function(){"use strict";Object.defineProperties(this,{name:{value:null,writable:!0},phone:{value:null,writable:!0},topic:{value:null,writable:!0},question:{value:null,writable:!0}})};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.CustomerServiceConnector=function(e){"use strict";this.NOT_AUTHORIZED=0,this.AUTH_WITH_AUTOLOGIN=5,this.AUTH_WITH_LOGIN=10,this.AUTH_WITH_PKK=20;var t=0,o=!1,n=null,r=null,a=null,i=e.endpoint,c=e.timeout,s=e.chatServiceConnector,l="json";this.invoke=function(){t=this.NOT_AUTHORIZED;var e=s.getAuthorizationLevel(function(e){t=e}),u=$.ajax(i,{dataType:l,timeout:c,jsonp:!1,xhrFields:{withCredentials:!0},success:function(e,t,i){o=!0,n=e.firstName,r=e.lastName,a=e.salutation},error:function(e,t,i){o=!1,n=null,r=null,a=null}});return o2.chat.Q.allSettled([e,u])};var u=function(){throw"Unsupported operation"};Object.defineProperties(this,{loggedIn:{get:function(){return t>=this.AUTH_WITH_LOGIN&&o},set:u,enumerable:!0},firstName:{get:function(){return n},set:u,enumerable:!0},lastName:{get:function(){return r},set:u,enumerable:!0},salutation:{get:function(){return a},set:u,enumerable:!0},authorizationLevel:{get:function(){return t},set:u,enumerable:!0}})};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.DebugConsole=function(){"use strict";var e=$("body"),t=$('<div style="position: fixed; overflow-y: scroll; top: 30px; right: 30px; width: 300px; height: 300px; max-height: 300px; z-index: 100; background: #ffff00; color: black; padding: 10px;"></div>');e.append(t),this.debug=function(e){var o=$("<p></p>");o.text(e),t.append(o),t.animate({scrollTop:t[0].scrollHeight},0)}};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.DefaultOptions=function(){"use strict";this.brandId=1,this.bo={baseUrl:location.protocol+"//"+location.host+"/o2-chat-backoffice-service/chat/",chatPath:"/",errorMessage:"Es ist ein technischer Fehler aufgetreten. Bitte versuche es zu einem spÃ¤teren Zeitpunkt erneut. Vielen Dank fÃ¼r dein VerstÃ¤ndnis. ["+o2.chat.ErrorCode.AJAX.code+"]"},this.init={"class":{active:null,inactive:null},externalPromises:[]},this.eventListeners={},this.templates={layout:null,layoutErrorMessage:"Es ist ein technischer Fehler aufgetreten. Bitte versuche es zu einem spÃ¤teren Zeitpunkt erneut. Vielen Dank fÃ¼r dein VerstÃ¤ndnis. ["+o2.chat.ErrorCode.AJAX.code+"]"},this.storage={prefix:"o2.chat.",iframe:null},this.messages={genericErrorMessage:"Es ist ein technischer Fehler aufgetreten. Bitte versuche es zu einem spÃ¤teren Zeitpunkt erneut. Vielen Dank fÃ¼r dein VerstÃ¤ndnis. ["+o2.chat.ErrorCode.AJAX.code+"]"},this.draggable=!0,this.showPersonalData={name:null,phone:null,topic:null,question:null},this.loginSupported=!0,this.fatalErrorCodes=[o2.chat.ErrorCode.NO_OPEN_CHAT,o2.chat.ErrorCode.CHAT_CLOSED_BY_AGENT,o2.chat.ErrorCode.ALL_AGENTS_BUSY,o2.chat.ErrorCode.CHAT_SESSION_LIMIT_EXCEEDED,o2.chat.ErrorCode.SERVICE_CLOSED,o2.chat.ErrorCode.CHAT_INACTIVE,o2.chat.ErrorCode.CHAT_IDLE_TIMEOUT,o2.chat.ErrorCode.INVALID_CHAT_ID,o2.chat.ErrorCode.INVALID_SERVICE_NAME,o2.chat.ErrorCode.SERVICE_SITE_CONFIG,o2.chat.ErrorCode.OUT_OF_OFFICE_HOURS,o2.chat.ErrorCode.BACKOFFICE_NOT_AVAILABLE]};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.DeviceTypeServiceConnector=function(e){"use strict";var t,o={desktop:"desktop",tablet:"desktop",smartphone:"smartphone",mobile:"smartphone"},n=o2.chat.Q.defer(),r=e.defaultDeviceType,a=e.defaultDeviceType,i=e.endpoint,c=e.timeout;$.ajax(i,{timeout:c,success:function(e,o,i){var c=i.getResponseHeader("x-o2-device-type");c&&(r=c),c=i.getResponseHeader("x-o2-view"),c&&(a=c),c=i.getResponseHeader("x-o2-view-preference"),c&&(t=c),n.resolve()},error:function(e,t,o){n.resolve()}});var s=function(){return o[r]?o[r]:e.defaultDeviceType},l=function(){throw"Unsupported operation"};Object.defineProperties(this,{deviceType:{get:s,set:l},view:{get:function(){return a},set:l},viewPreference:{get:function(){return t},set:l},promise:{get:function(){return n.promise},set:l}})};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.ErrorCode=function(e){this.code=e,o2.chat.ErrorCode.values[e]=this},o2.chat.ErrorCode.values={},o2.chat.ErrorCode.fromCode=function(e){return o2.chat.ErrorCode.values[e]},o2.chat.ErrorCode.GENERIC=new o2.chat.ErrorCode(0),o2.chat.ErrorCode.NO_OPEN_CHAT=new o2.chat.ErrorCode(1),o2.chat.ErrorCode.TECHNICAL=new o2.chat.ErrorCode(2),o2.chat.ErrorCode.CHAT_CLOSED_BY_AGENT=new o2.chat.ErrorCode(3),o2.chat.ErrorCode.ALL_AGENTS_BUSY=new o2.chat.ErrorCode(4),o2.chat.ErrorCode.CHAT_SESSION_LIMIT_EXCEEDED=new o2.chat.ErrorCode(5),o2.chat.ErrorCode.SERVICE_CLOSED=new o2.chat.ErrorCode(6),o2.chat.ErrorCode.BUSINESS=new o2.chat.ErrorCode(8),o2.chat.ErrorCode.CHAT_INACTIVE=new o2.chat.ErrorCode(9),o2.chat.ErrorCode.CHAT_IDLE_TIMEOUT=new o2.chat.ErrorCode(10),o2.chat.ErrorCode.MAX_USER_ACTION=new o2.chat.ErrorCode(11),o2.chat.ErrorCode.REQUEST_THROTTLE=new o2.chat.ErrorCode(12),o2.chat.ErrorCode.INVALID_ARGUMENT=new o2.chat.ErrorCode(13),o2.chat.ErrorCode.BACKEND_UNAVAILABLE=new o2.chat.ErrorCode(14),o2.chat.ErrorCode.REQUEST_FAILED=new o2.chat.ErrorCode(15),o2.chat.ErrorCode.INVALID_CHAT_ID=new o2.chat.ErrorCode(16),o2.chat.ErrorCode.INVALID_SERVICE_NAME=new o2.chat.ErrorCode(17),o2.chat.ErrorCode.WEB_SERVICE=new o2.chat.ErrorCode(18),o2.chat.ErrorCode.SOCKET_TIMEOUT=new o2.chat.ErrorCode(19),o2.chat.ErrorCode.SERVICE_SITE_CONFIG=new o2.chat.ErrorCode(20),o2.chat.ErrorCode.OUT_OF_OFFICE_HOURS=new o2.chat.ErrorCode(21),o2.chat.ErrorCode.CHAT_PARAMETER=new o2.chat.ErrorCode(22),o2.chat.ErrorCode.CUSTOMER_NOT_AUTHORIZED=new o2.chat.ErrorCode(23),o2.chat.ErrorCode.CONNECTION_PROBLEM=new o2.chat.ErrorCode(91),o2.chat.ErrorCode.LAYOUT_TEMPLATE_ERROR=new o2.chat.ErrorCode(93),o2.chat.ErrorCode.CHAT_ALREADY_ACTIVE=new o2.chat.ErrorCode(94),o2.chat.ErrorCode.BACKOFFICE_NOT_AVAILABLE=new o2.chat.ErrorCode(95),o2.chat.ErrorCode.ALL_DEPARTMENTS_CLOSED=new o2.chat.ErrorCode(96),o2.chat.ErrorCode.CLIENT_SITE_CONFIG=new o2.chat.ErrorCode(98),o2.chat.ErrorCode.AJAX=new o2.chat.ErrorCode(99);var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.Event=function(e,t,o){"use strict";var n=!1;if(Object.defineProperties(this,{type:{value:e,writable:!1,enumerable:!0},source:{value:t,writable:!1,enumerable:!0}}),void 0!==o)for(var r in o)o.hasOwnProperty(r)&&Object.defineProperty(this,r,{value:o[r],writable:!1,enumerable:!0});this.stopPropagation=function(){n=!0},this.isStopPropagation=function(){return n}};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.NoTopicsException=function(){"use strict"},o2.chat.NoTopicsException.prototype=new Error;var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.GoogleAnalytics=function(){"use strict";var e,t=[],o={},n="Chat Einladung",r=0,a=!1,i=!1,c=!1;this.onEvent=function(e){i&&(c||(c=!0,e.source.logMessage("Google Analytics configuration is missing"))),o.hasOwnProperty(e.type)&&"function"==typeof o[e.type]&&o[e.type](e)},o.backofficeConfigurationLoaded=function(e){var o;if(i=!window._gaq&&!e.configuration.googleAnalyticsId,!window._gaq&&e.configuration.googleAnalyticsId){for(window._gaq=[],window._gaq.push(["_setAccount",e.configuration.googleAnalyticsId]),window._gaq.push(["_gat._anonymizeIp"]),window._gaq.push(["_trackPageview"]),o=0;o<t.length;o++)window._gaq.push(t[o]);!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()}},o.start=function(e){"link"===e.startedFrom?n="Chat Link":"button"===e.startedFrom&&(n="Chat Selfstart"),s(n,"start")},o.customerGroupSelected=function(e){s(n,e.customerGroup.label)},o.connected=function(t){e=t.connection.subTopic,a=!0,r=(new Date).getTime(),s(e,"Chat starten")},o.messageReceived=function(){if(r>0){var t=(new Date).getTime()-r;s(e,"BegrÃ¼Ãung",t/1e3),r=0}},o.closing=function(){a&&s(e,"SchlieÃen")},o.closed=function(){a&&s(e,"SchlieÃen BestÃ¤tigung"),a=!1},o.closed=function(){a&&s(e,"SchlieÃen Anullieren")};var s=function(e,o,n){var r=window._gaq?window._gaq:t;void 0!==n?r.push(["_trackEvent","chat",e,o,n]):r.push(["_trackEvent","chat",e,o])}};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.GoogleTagManager=function(){"use strict";var e,t={},o="Chat Einladung",n=0,r=!1,a=!1,i=!1;window.tefDataLayer||(window.tefDataLayer=[]),this.onEvent=function(e){a&&(i||(i=!0,e.source.logMessage("Google Tag Manager configuration is missing"))),t.hasOwnProperty(e.type)&&"function"==typeof t[e.type]&&t[e.type](e)},t.backofficeConfigurationLoaded=function(e){a=!e.configuration.googleAnalyticsId,e.configuration.googleAnalyticsId&&!function(e,t,o,n,r){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(o)[0],i=t.createElement(o),c="dataLayer"!=n?"&l="+n:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+r+c,a.parentNode.insertBefore(i,a)}(window,document,"script","tefDataLayer",e.configuration.googleAnalyticsId)},t.start=function(e){"link"===e.startedFrom?o="Chat Link":"button"===e.startedFrom&&(o="Chat Selfstart"),c(o,"start")},t.customerGroupSelected=function(e){c(o,e.customerGroup.label)},t.topicSelected=function(e){c(o,e.topic)},t.connected=function(t){e=t.connection.subTopic,r=!0,n=(new Date).getTime(),c(e,"Chat starten")},t.messageReceived=function(){if(n>0){var t=(new Date).getTime()-n;c(e,"BegrÃ¼Ãung",t/1e3),n=0}},t.closing=function(){r&&c(e,"SchlieÃen")},t.closed=function(){r&&c(e,"SchlieÃen BestÃ¤tigung"),r=!1},t.closed=function(){r&&c(e,"SchlieÃen Anullieren")};var c=function(e,t,o){var n={event:"chat",action:e,label:t};o&&(n.value=o),window.tefDataLayer.push(n)}};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.Logger=function(e,t){"use strict";this.logMessage=function(e){t.logMessage(e)},this.logRequestError=function(e){var o=0,n=0;e.httpError?(o=99,n=e.status):(o=e.status,n=200);var r=e.url.match(/\/([^\/\?]*)(\?.*)?$/)[1],a=e.url.match(/^https:.*/)?"SSL":"NOSSL",i=e.data&&e.data["o2ChatService-callId"]?e.data["o2ChatService-callId"]:"-",c="_",s=void 0!==e.errorType?e.errorType:"backend",l=o+c+s+c+n+c+r+c+e.method+c+"JSON"+c+a;t.logRequestError("REST error",e),t.logAlive(i,l)},this.logException=function(n){var r=o2.chat.Q.defer(),a=o2.chat.Q.defer();if("undefined"==typeof Promise){var i=document.createElement("script");i.setAttribute("src",e.dependencies.promise),i.onload=r.resolve,document.body.appendChild(i)}else r.resolve();if(o2.chat.stacktrace)a.resolve();else{var c=document.createElement("script");c.setAttribute("src",e.dependencies.stacktraceJs),c.onload=a.resolve,document.body.appendChild(c)}o2.chat.Q.allSettled([r.promise,a.promise]).then(function(){(new o2.chat.stacktrace.StackTrace).fromError(n).then(function(e){var r=o(e);t.logException(n.message,r)})})};var o=function(e){for(var t=[],o=0;o<e.length;o++){var n=e[o].fileName,r=n.lastIndexOf("/");r>=0&&(n=n.substring(r+1));var a={fileName:n,lineNumber:e[o].lineNumber,columnNumber:e[o].columnNumber};if(e[o].functionName){var i=e[o].functionName;r=i.lastIndexOf("."),r>=0&&(i=i.substring(r+1)),r=i.lastIndexOf("/"),r>=0&&(i=i.substring(r+1)),a.functionName=i}t.push(a)}return t}};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.Options=function(e){"use strict";$.extend(!0,this,new o2.chat.DefaultOptions,e);var t=o2.chat.Util.getUrlParameters();"0"===t["chat-login-supported"]&&(this.loginSupported=!1),"1"===t["chat-login-supported"]&&(this.loginSupported=!0),Object.defineProperty(this,"embedded",{get:function(){return"embedded"===this.mode}}),Object.defineProperty(this,"standalone",{get:function(){return"standalone"===this.mode}})};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},function(e){"use strict";o2.chat.Q=e()}(function(){"use strict";function e(e){return function(){return Q.apply(e,arguments)}}function t(e){return e===Object(e)}function o(e){return"[object StopIteration]"===te(e)||e instanceof B}function n(e,t){if(G&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&e.stack.indexOf(oe)===-1){for(var o=[],n=t;n;n=n.source)n.stack&&o.unshift(n.stack);o.unshift(e.stack);var a=o.join("\n"+oe+"\n");e.stack=r(a)}}function r(e){for(var t=e.split("\n"),o=[],n=0;n<t.length;++n){var r=t[n];c(r)||a(r)||!r||o.push(r)}return o.join("\n")}function a(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function i(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var o=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(o)return[o[1],Number(o[2])];var n=/.*@(.+):(\d+)$/.exec(e);return n?[n[1],Number(n[2])]:void 0}function c(e){var t=i(e);if(!t)return!1;var o=t[0],n=t[1];return o===q&&n>=F&&n<=ie}function s(){if(G)try{throw new Error}catch(e){var t=e.stack.split("\n"),o=t[0].indexOf("@")>0?t[1]:t[2],n=i(o);if(!n)return;return q=n[0],n[1]}}function l(e,t,o){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn,e.apply(e,arguments)}}function u(e){return e instanceof f?e:y(e)?I(e):D(e)}function h(){function e(e){t=e,a.source=e,V(o,function(t,o){u.nextTick(function(){e.promiseDispatch.apply(e,o)})},void 0),o=void 0,n=void 0}var t,o=[],n=[],r=Y(h.prototype),a=Y(f.prototype);if(a.promiseDispatch=function(e,r,a){var i=W(arguments);o?(o.push(i),"when"===r&&a[1]&&n.push(a[1])):u.nextTick(function(){t.promiseDispatch.apply(t,i)})},a.valueOf=function(){if(o)return a;var e=m(t);return v(e)&&(t=e),e},a.inspect=function(){return t?t.inspect():{state:"pending"}},u.longStackSupport&&G)try{throw new Error}catch(i){a.stack=i.stack.substring(i.stack.indexOf("\n")+1)}return r.promise=a,r.resolve=function(o){t||e(u(o))},r.fulfill=function(o){t||e(D(o))},r.reject=function(o){t||e(S(o))},r.notify=function(e){t||V(n,function(t,o){u.nextTick(function(){o(e)})},void 0)},r}function p(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=h();try{e(t.resolve,t.reject,t.notify)}catch(o){t.reject(o)}return t.promise}function d(e){return p(function(t,o){for(var n=0,r=e.length;n<r;n++)u(e[n]).then(t,o)})}function f(e,t,o){void 0===t&&(t=function(e){return S(new Error("Promise does not support operation: "+e))}),void 0===o&&(o=function(){return{state:"unknown"}});var n=Y(f.prototype);if(n.promiseDispatch=function(o,r,a){var i;try{i=e[r]?e[r].apply(n,a):t.call(n,r,a)}catch(c){i=S(c)}o&&o(i)},n.inspect=o,o){var r=o();"rejected"===r.state&&(n.exception=r.reason),n.valueOf=function(){var e=o();return"pending"===e.state||"rejected"===e.state?n:e.value}}return n}function g(e,t,o,n){return u(e).then(t,o,n)}function m(e){if(v(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function v(e){return e instanceof f}function y(e){return t(e)&&"function"==typeof e.then}function w(e){return v(e)&&"pending"===e.inspect().state}function C(e){return!v(e)||"fulfilled"===e.inspect().state}function E(e){return v(e)&&"rejected"===e.inspect().state}function b(){ne.length=0,re.length=0,ae||(ae=!0)}function T(e,t){ae&&(re.push(e),t&&"undefined"!=typeof t.stack?ne.push(t.stack):ne.push("(no stack) "+t))}function k(e){if(ae){var t=J(re,e);t!==-1&&(re.splice(t,1),ne.splice(t,1))}}function S(e){var t=f({when:function(t){return t&&k(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return T(t,e),t}function D(e){return f({when:function(){return e},get:function(t){return e[t]},set:function(t,o){e[t]=o},"delete":function(t){delete e[t]},post:function(t,o){return null===t||void 0===t?e.apply(void 0,o):e[t].apply(e,o)},apply:function(t,o){return e.apply(t,o)},keys:function(){return ee(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function I(e){var t=h();return u.nextTick(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(o){t.reject(o)}}),t.promise}function P(e){return f({isDef:function(){}},function(t,o){return L(e,t,o)},function(){return u(e).inspect()})}function O(e,t,o){return u(e).spread(t,o)}function U(e){return function(){function t(e,t){var i;if("undefined"==typeof StopIteration){try{i=n[e](t)}catch(c){return S(c)}return i.done?u(i.value):g(i.value,r,a)}try{i=n[e](t)}catch(c){return o(c)?u(c.value):S(c)}return g(i,r,a)}var n=e.apply(this,arguments),r=t.bind(t,"next"),a=t.bind(t,"throw");return r()}}function A(e){u.done(u.async(e)())}function x(e){throw new B(e)}function N(e){return function(){return O([this,_(arguments)],function(t,o){return e.apply(t,o)})}}function L(e,t,o){return u(e).dispatch(t,o)}function _(e){return g(e,function(e){var t=0,o=h();return V(e,function(n,r,a){var i;v(r)&&"fulfilled"===(i=r.inspect()).state?e[a]=i.value:(++t,g(r,function(n){e[a]=n,0===--t&&o.resolve(e)},o.reject,function(e){o.notify({index:a,value:e})}))},void 0),0===t&&o.resolve(e),o.promise})}function R(e){return g(e,function(e){return e=X(e,u),g(_(X(e,function(e){return g(e,z,z)})),function(){return e})})}function j(e){return u(e).allSettled()}function M(e,t){return u(e).then(void 0,void 0,t)}function H(e,t){return u(e).nodeify(t)}var G=!1;try{throw new Error}catch($){G=!!$.stack}var q,B,F=s(),z=function(){},K=function(){function e(){for(;t.next;){t=t.next;var o=t.task;t.task=void 0;var r=t.domain;r&&(t.domain=void 0,r.enter());try{o()}catch(i){if(a)throw r&&r.exit(),setTimeout(e,0),r&&r.enter(),i;setTimeout(function(){throw i},0)}r&&r.exit()}n=!1}var t={task:void 0,next:null},o=t,n=!1,r=void 0,a=!1;if(K=function(e){o=o.next={task:e,domain:a&&process.domain,next:null},n||(n=!0,r())},"undefined"!=typeof process&&process.nextTick)a=!0,r=function(){process.nextTick(e)};else if("function"==typeof setImmediate)r="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var i=new MessageChannel;i.port1.onmessage=function(){r=c,i.port1.onmessage=e,e()};var c=function(){i.port2.postMessage(0)};r=function(){setTimeout(e,0),c()}}else r=function(){setTimeout(e,0)};return K}(),Q=Function.call,W=e(Array.prototype.slice),V=e(Array.prototype.reduce||function(e,t){var o=0,n=this.length;if(1===arguments.length)for(;;){if(o in this){t=this[o++];break}if(++o>=n)throw new TypeError}for(;o<n;o++)o in this&&(t=e(t,this[o],o));return t}),J=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),X=e(Array.prototype.map||function(e,t){var o=this,n=[];return V(o,function(r,a,i){n.push(e.call(t,a,i,o))},void 0),n}),Y=Object.create||function(e){function t(){}return t.prototype=e,new t},Z=e(Object.prototype.hasOwnProperty),ee=Object.keys||function(e){var t=[];for(var o in e)Z(e,o)&&t.push(o);return t},te=e(Object.prototype.toString);B="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var oe="From previous event:";u.resolve=u,u.nextTick=K,u.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(u.longStackSupport=!0),u.defer=h,h.prototype.makeNodeResolver=function(){var e=this;return function(t,o){t?e.reject(t):arguments.length>2?e.resolve(W(arguments,1)):e.resolve(o)}},u.Promise=p,u.promise=p,p.race=d,p.all=_,p.reject=S,p.resolve=u,u.passByCopy=function(e){return e},f.prototype.passByCopy=function(){return this},u.join=function(e,t){return u(e).join(t)},f.prototype.join=function(e){return u([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},u.race=d,f.prototype.race=function(){return this.then(u.race)},u.makePromise=f,f.prototype.toString=function(){return"[object Promise]"},f.prototype.then=function(e,t,o){function r(t){try{return"function"==typeof e?e(t):t}catch(o){return S(o)}}function a(e){if("function"==typeof t){n(e,c);try{return t(e)}catch(o){return S(o)}}return S(e)}function i(e){return"function"==typeof o?o(e):e}var c=this,s=h(),l=!1;return u.nextTick(function(){c.promiseDispatch(function(e){l||(l=!0,s.resolve(r(e)))},"when",[function(e){l||(l=!0,s.resolve(a(e)))}])}),c.promiseDispatch(void 0,"when",[void 0,function(e){var t,o=!1;try{t=i(e)}catch(n){if(o=!0,!u.onerror)throw n;u.onerror(n)}o||s.notify(t)}]),s.promise},u.tap=function(e,t){return u(e).tap(t)},f.prototype.tap=function(e){return e=u(e),this.then(function(t){return e.fcall(t).thenResolve(t)})},u.when=g,f.prototype.thenResolve=function(e){return this.then(function(){return e})},u.thenResolve=function(e,t){return u(e).thenResolve(t)},f.prototype.thenReject=function(e){return this.then(function(){throw e})},u.thenReject=function(e,t){return u(e).thenReject(t)},u.nearer=m,u.isPromise=v,u.isPromiseAlike=y,u.isPending=w,f.prototype.isPending=function(){return"pending"===this.inspect().state},u.isFulfilled=C,f.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},u.isRejected=E,f.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ne=[],re=[],ae=!0;u.resetUnhandledRejections=b,u.getUnhandledReasons=function(){return ne.slice()},u.stopUnhandledRejectionTracking=function(){b(),ae=!1},b(),u.reject=S,u.fulfill=D,u.master=P,u.spread=O,f.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},u.async=U,u.spawn=A,u["return"]=x,u.promised=N,u.dispatch=L,f.prototype.dispatch=function(e,t){var o=this,n=h();return u.nextTick(function(){o.promiseDispatch(n.resolve,e,t)}),n.promise},u.get=function(e,t){return u(e).dispatch("get",[t])},f.prototype.get=function(e){return this.dispatch("get",[e])},u.set=function(e,t,o){return u(e).dispatch("set",[t,o])},f.prototype.set=function(e,t){return this.dispatch("set",[e,t])},u.del=u["delete"]=function(e,t){return u(e).dispatch("delete",[t])},f.prototype.del=f.prototype["delete"]=function(e){return this.dispatch("delete",[e])},u.mapply=u.post=function(e,t,o){return u(e).dispatch("post",[t,o])},f.prototype.mapply=f.prototype.post=function(e,t){return this.dispatch("post",[e,t])},u.send=u.mcall=u.invoke=function(e,t){return u(e).dispatch("post",[t,W(arguments,2)])},f.prototype.send=f.prototype.mcall=f.prototype.invoke=function(e){return this.dispatch("post",[e,W(arguments,1)])},u.fapply=function(e,t){return u(e).dispatch("apply",[void 0,t])},f.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},u["try"]=u.fcall=function(e){return u(e).dispatch("apply",[void 0,W(arguments,1)])},f.prototype.fcall=function(){return this.dispatch("apply",[void 0,W(arguments)])},u.fbind=function(e){var t=u(e),o=W(arguments,1);return function(){return t.dispatch("apply",[this,o.concat(W(arguments))])}},f.prototype.fbind=function(){var e=this,t=W(arguments);return function(){return e.dispatch("apply",[this,t.concat(W(arguments))])}},u.keys=function(e){return u(e).dispatch("keys",[])},f.prototype.keys=function(){return this.dispatch("keys",[])},u.all=_,f.prototype.all=function(){return _(this)},u.allResolved=l(R,"allResolved","allSettled"),f.prototype.allResolved=function(){return R(this)},u.allSettled=j,f.prototype.allSettled=function(){return this.then(function(e){return _(X(e,function(e){function t(){return e.inspect()}return e=u(e),e.then(t,t)}))})},u.fail=u["catch"]=function(e,t){return u(e).then(void 0,t)},f.prototype.fail=f.prototype["catch"]=function(e){return this.then(void 0,e)},u.progress=M,f.prototype.progress=function(e){return this.then(void 0,void 0,e)},u.fin=u["finally"]=function(e,t){return u(e)["finally"](t)},f.prototype.fin=f.prototype["finally"]=function(e){return e=u(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},u.done=function(e,t,o,n){return u(e).done(t,o,n)},f.prototype.done=function(e,t,o){var r=function(e){u.nextTick(function(){if(n(e,a),!u.onerror)throw e;u.onerror(e)})},a=e||t||o?this.then(e,t,o):this;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),a.then(void 0,r)},u.timeout=function(e,t,o){return u(e).timeout(t,o)},f.prototype.timeout=function(e,t){var o=h(),n=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+e+" ms"),t.code="ETIMEDOUT"),o.reject(t)},e);return this.then(function(e){clearTimeout(n),o.resolve(e)},function(e){clearTimeout(n),o.reject(e)},o.notify),o.promise},u.delay=function(e,t){return void 0===t&&(t=e,e=void 0),u(e).delay(t)},f.prototype.delay=function(e){return this.then(function(t){var o=h();return setTimeout(function(){o.resolve(t)},e),o.promise})},u.nfapply=function(e,t){return u(e).nfapply(t)},f.prototype.nfapply=function(e){var t=h(),o=W(e);return o.push(t.makeNodeResolver()),this.fapply(o).fail(t.reject),t.promise},u.nfcall=function(e){var t=W(arguments,1);return u(e).nfapply(t)},f.prototype.nfcall=function(){var e=W(arguments),t=h();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},u.nfbind=u.denodeify=function(e){var t=W(arguments,1);return function(){var o=t.concat(W(arguments)),n=h();return o.push(n.makeNodeResolver()),u(e).fapply(o).fail(n.reject),n.promise}},f.prototype.nfbind=f.prototype.denodeify=function(){var e=W(arguments);return e.unshift(this),u.denodeify.apply(void 0,e)},u.nbind=function(e,t){var o=W(arguments,2);return function(){function n(){return e.apply(t,arguments)}var r=o.concat(W(arguments)),a=h();return r.push(a.makeNodeResolver()),u(n).fapply(r).fail(a.reject),a.promise}},f.prototype.nbind=function(){var e=W(arguments,0);return e.unshift(this),u.nbind.apply(void 0,e)},u.nmapply=u.npost=function(e,t,o){
return u(e).npost(t,o)},f.prototype.nmapply=f.prototype.npost=function(e,t){var o=W(t||[]),n=h();return o.push(n.makeNodeResolver()),this.dispatch("post",[e,o]).fail(n.reject),n.promise},u.nsend=u.nmcall=u.ninvoke=function(e,t){var o=W(arguments,2),n=h();return o.push(n.makeNodeResolver()),u(e).dispatch("post",[t,o]).fail(n.reject),n.promise},f.prototype.nsend=f.prototype.nmcall=f.prototype.ninvoke=function(e){var t=W(arguments,1),o=h();return t.push(o.makeNodeResolver()),this.dispatch("post",[e,t]).fail(o.reject),o.promise},u.nodeify=H,f.prototype.nodeify=function(e){return e?void this.then(function(t){u.nextTick(function(){e(null,t)})},function(t){u.nextTick(function(){e(t)})}):this};var ie=s();return u});var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.SessionStorage=function(){"use strict";function e(e,t){n&&n.setItem(e,t)}function t(e){return!!n&&null!==n.getItem(e)}function o(e){if(n){var t=n.getItem(e);return n.removeItem(e),t}}var n=null;try{n=sessionStorage}catch(r){}return{setProperty:e,hasProperty:t,getAndRemoveProperty:o}}();var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.Siteconfig={},o2.chat.Siteconfig.init=function(e){"use strict";var t=o2.chat.Q.defer(),o=[];if(e.pagecontent){var n=$.ajax(e.pagecontent,{dataType:"html",cache:!0,success:function(e){$("#pagecontent").replaceWith($(e))},error:function(t,o,n){o2.chat.Siteconfig.errorHandlers.url(e.pagecontent,t.status)}});o.push(n)}var r=new o2.chat.URLUtils(e.siteconfig,location.href).href;return $.ajax(r,{dataType:"xml",cache:!0,success:function(e){var n=$(e);$('[id^="siteconfig."]').each(function(e,t){!function(){var e=$(t),a=e.attr("id").substring(11),i=new o2.chat.URLUtils(n.find("#"+a).text(),r).href,c=o2.chat.Q.defer();o.push(c.promise),$.ajax(i,{dataType:"html",cache:!0,success:function(t){for(var o=[],n=$.parseHTML(t,document,!0),r=0;r<n.length;r++){var a=n[r];1===a.nodeType&&"script"===a.localName&&a.src?!function(){var e=a.src;o.push($.ajax(a.src,{dataType:"script",cache:!0,success:function(e){},error:function(t,o,n){o2.chat.Siteconfig.errorHandlers.url(e,t.status)}}))}():8!==a.nodeType&&e[0].parentNode.insertBefore(a,e[0])}e.remove(),o2.chat.Q.allSettled(o).then(function(){c.resolve()})},error:function(e,t,o){o2.chat.Siteconfig.errorHandlers.url(i,e.status)}})}()}),o.push(o2.chat.Siteconfig.bootstrapDefer.promise),o2.chat.Q.allSettled(o).then(function(){t.resolve()})},error:function(e,t,o){o2.chat.Siteconfig.errorHandlers.url(r,e.status)}}),o2.chat.Siteconfig.initTimestamp=(new Date).getTime(),window.setTimeout(o2.chat.Siteconfig.waitForBootstrap,50),t.promise},o2.chat.Siteconfig.bootstrapDefer=o2.chat.Q.defer(),o2.chat.Siteconfig.waitForBootstrap=function(){if("function"==typeof $.fn.popover)o2.chat.Siteconfig.bootstrapDefer.resolve();else{var e=(new Date).getTime();e-o2.chat.Siteconfig.initTimestamp<1e4?window.setTimeout(o2.chat.Siteconfig.waitForBootstrap,50):o2.chat.Siteconfig.errorHandlers.bootstrapTimeout()}},o2.chat.Siteconfig.errorHandlers={alreadyFailed:!1,url:function(e,t){o2.chat.Siteconfig.errorHandlers.alreadyFailed||(o2.chat.Siteconfig.errorHandlers.alreadyFailed=!0,window.location="error.html?url="+encodeURIComponent(e)+"&status="+encodeURIComponent(t))},bootstrapTimeout:function(){o2.chat.Siteconfig.errorHandlers.alreadyFailed||(o2.chat.Siteconfig.errorHandlers.alreadyFailed=!0,window.location="error.html?err=bootstrap-init")}};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.TouchDragger=function(e,t){"use strict";var o;if("ontouchend"in document){var n=function(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var o=e.originalEvent.changedTouches[0],n=document.createEvent("MouseEvents");n.initMouseEvent(t,!0,!0,window,1,o.screenX,o.screenY,o.clientX,o.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(n)}};t.on({touchstart:function(e){var t=this;o||(o=!0,t._touchMoved=!1,n(e,"mouseover"),n(e,"mousemove"),n(e,"mousedown"))},touchmove:function(e){o&&(this._touchMoved=!0,n(e,"mousemove"))},touchend:function(e){o&&(n(e,"mouseup"),n(e,"mouseout"),this._touchMoved||n(e,"click"),o=!1)}})}};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.URLUtils=function(e,t){var o=String(e).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(?:\/\/(?:([^:@\/?#]*)(?::([^:@\/?#]*))?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);if(!o)throw new RangeError;var n=o[1]||"",r=o[2]||"",a=o[3]||"",i=o[4]||"",c=o[5]||"",s=o[6]||"",l=o[7]||"",u=o[8]||"",h=o[9]||"";if(void 0!==t){var p=new o2.chat.URLUtils(t),d=""===n&&""===i&&""===r;d&&""===l&&""===u&&(u=p.search),d&&"/"!==l.charAt(0)&&(l=""!==l?(""===p.host&&""===p.username||""!==p.pathname?"":"/")+p.pathname.slice(0,p.pathname.lastIndexOf("/")+1)+l:p.pathname);var f=[];l.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(e){"/.."===e?f.pop():f.push(e)}),l=f.join("").replace(/^\//,"/"===l.charAt(0)?"/":""),d&&(s=p.port,c=p.hostname,i=p.host,a=p.password,r=p.username),""===n&&(n=p.protocol)}this.origin=n+(""!==n||""!==i?"//":"")+i,this.href=n+(""!==n||""!==i?"//":"")+(""!==r?r+(""!==a?":"+a:"")+"@":"")+i+l+u+h,this.protocol=n,this.username=r,this.password=a,this.host=i,this.hostname=c,this.port=s,this.pathname=l,this.search=u,this.hash=h};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.Util={},o2.chat.Util.getUrlParameters=function(){"use strict";var e={};return window.location.href.replace(/[?&]+([^=&;#]+)($|=)([^&;#]*)/gi,function(t,o,n,r){e[o]=decodeURIComponent(r)}),e},o2.chat.Util.getUrlParameter=function(e){"use strict";return o2.chat.Util.getUrlParameters()[e]},o2.chat.Util.getUrlWithHostIfProvided=function(e,t){var o=o2.chat.Util.getUrlParameter(t);if("undefined"==typeof o)return e;var n=o+e;return n},o2.chat.Util.setActiveWindow=function(){localStorage.setItem("activeWindowExists",!0)},o2.chat.Util.setDeactiveWindow=function(){localStorage.setItem("activeWindowExists",!1)},o2.chat.Util.getActiveWindowStatus=function(){return JSON.parse(localStorage.getItem("activeWindowExists"))},o2.chat.Util.removeActiveWindowStatus=function(){localStorage.removeItem("activeWindowExists")},o2.chat.Util.isSameOrigin=function(e,t,o){if(e&&"https"!==location.protocol)return!1;if(t!==location.host)return!1;var n,r;return n=o?o:"http:"===location.protocol?80:443,r=location.port?location.port:"http:"===location.protocol?80:443,n===r};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.integration=o2.chat.integration||{},o2.chat.integration.Default={},$(document).on("tel.app.init",function(){o2.chat.integration.Default.initMainPage()}),o2.chat.integration.Default.init=function(e){"use strict";location.href.indexOf("chat-ui")>=0||o2.chat.integration.Default.initMainPage()},o2.chat.integration.Default.initMainPage=function(){try{var e=$("#chat, .chat-app");if(e.length<1)return;var t,o,n=$(e.get(0)),r=!1,a=o2.chat.integration.Default.getBrandId();if(0===location.host.indexOf("vpint")||location.host.indexOf("local")>=0||location.host.indexOf("dev")>=0||location.host.indexOf("test")>=0?a===-1?(t="//vpint03.base.de",o="/o2-chat-ui"):1===a?(t="//vpint05.o2online.de",o="/chat-ui"):2===a&&(t="//vpint05.blau.de",o="/chat-ui"):0===location.host.indexOf("prev")?a===-1?(t="//ort.base.de",o="/o2-chat-ui"):1===a?(t="//ort.o2online.de",o="/chat-ui"):2===a&&(t="//ort.blau.de",o="/chat-ui"):(t="//"+location.host,o="/chat-ui"),n.data("o2.chat.initialized"))return;n.data("o2.chat.initialized",!0),n.o2chat({brandId:a,mode:"embedded",chatPageUrl:t+o+"/chat.html",bo:{baseUrl:t+"/o2-chat-backoffice-service/chat/",cfgPath:location.pathname},init:{externalPromises:[]},templates:{layout:t+o+"/chat-overlay-layout.html"},dependencies:{stacktraceJs:t+o+"/js/st.js",promise:t+o+"/js/es6-promise.min.js",jQueryUI:t+o+"/js/jquery-ui.min.js"},eventListeners:{initialized:[function(t){r=t.active,e.toggle(r)},function(e){$(document).trigger("chat:initialized")}],any:[function(e){}]},loginSupported:a!=-1}),e.click(function(){n.o2chat().startChatButtonClicked()})}catch(i){}},o2.chat.integration.Default.getBrandId=function(){var e=0;if(location.host.indexOf("o2.de")>=0)e=1;else if(location.host.indexOf("o2online.de")>=0)e=1;else if(location.host.indexOf("base.de")>=0)e=-1;else if(location.host.indexOf("blau.de")>=0)e=2;else{if(!(location.host.indexOf("localhost")>=0))throw"Unable to automatically detect brand from page URL.";e=1}return e};var o2=window.o2||{};window.o2=o2,o2.chat=o2.chat||{},o2.chat.integration=o2.chat.integration||{},o2.chat.integration.test=o2.chat.integration.test||{},o2.chat.integration.test.O2=o2.chat.integration.test.O2||{};const siteConfigPath="/siteconfig/chat-bootstrap/?view=Siteconfig",boPath="/o2-chat-backoffice-service/chat/",cmsHostParameterName="cmsHost",boHostParameterName="boHost";o2.chat.integration.test.O2.initMainPage=function(){o2.chat.Siteconfig.init({siteconfig:o2.chat.Util.getUrlWithHostIfProvided(siteConfigPath,cmsHostParameterName)}).then(function(){try{var e=$("#chat, .chat-app");if(e.length<1)return;var t=$(e.get(0));if(t.data("o2.chat.initialized"))return;t.data("o2.chat.initialized",!0);var o=o2.chat.integration.test.O2.getBrandId();t.o2chat({brandId:o,mode:"embedded",chatPageUrl:"chat.html",bo:{baseUrl:o2.chat.Util.getUrlWithHostIfProvided(boPath,boHostParameterName),cfgPath:location.pathname},init:{externalPromises:[]},templates:{layout:"chat-overlay-layout.html"},dependencies:{stacktraceJs:"js/st.js",promise:"js/es6-promise.min.js",jQueryUI:"js/jquery-ui.min.js"},eventListeners:{initialized:[function(t){t.active?e.removeAttr("disabled"):e.attr("disabled",!0),$("#chat-button-feedback").text("initialized, active: "+t.active),$("body").show()},function(e){$(document).trigger("chat:initialized")}],any:[function(e){}]},loginSupported:o!=-1}),e.click(function(){t.o2chat().startChatButtonClicked()})}catch(n){}})},o2.chat.integration.test.O2.initChatPage=function(){o2.chat.Siteconfig.init({siteconfig:o2.chat.Util.getUrlWithHostIfProvided(siteConfigPath,cmsHostParameterName),pagecontent:"chat-page-layout.html"}).then(function(){try{var e=new o2.chat.GoogleTagManager,t=$("body"),o=o2.chat.integration.test.O2.getBrandId();t.o2chat({brandId:o,mode:"standalone",bo:{baseUrl:o2.chat.Util.getUrlWithHostIfProvided(boPath,boHostParameterName),cfgPath:o2.chat.Util.getUrlParameters().cfgpath},init:{externalPromises:[]},templates:{layout:$("#chat-container")},dependencies:{stacktraceJs:"js/st.js",promise:"js/es6-promise.min.js",jQueryUI:"js/jquery-ui.min.js"},eventListeners:{initialized:function(e){},showLayout:function(e){t.show()},any:[function(e){},e]},loginSupported:o!=-1});var n=t.o2chat();n.initializationPromise.then(function(){n.openDialog({customerGroup:o2.chat.Util.getUrlParameter("cg"),customerGroupLoginRedirect:o2.chat.Util.getUrlParameter("cg-redirect")})})}catch(r){}})["catch"](function(e){})},o2.chat.integration.test.O2.getBrandId=function(){var e=0;if(location.host.indexOf("o2.de")>=0)e=1;else if(location.host.indexOf("o2online.de")>=0)e=1;else if(location.host.indexOf("base.de")>=0)e=-1;else if(location.host.indexOf("blau.de")>=0)e=2;else{if(!(location.host.indexOf("localhost")>=0))throw"Unable to automatically detect brand from page URL.";e=1}return e};
//# sourceMappingURL=app.min.js.map
